<center> <h1> Term Project I. IMDb pipeline
</h1> </center>

> All files listed here can be found under my [Github repository](https://github.com/nszoni/ceu-dataeng1/tree/main/term1)

# Table of contents

1. [Introduction](#introduction)
2. [Operational Layer](#operational)
3. [Analytics (Business Definitions)](#business)
4. [Denormalization](#denorm)
5. [ETL Pipeline](#etl)
6. [Data Mart](#mart)
7. [Delivery](#delivery)

<div id='introduction'/>

## Introduction

I choose to work with data on movies becuase I am a huge fan of the industry and spend a lot of time browsing reviews.

Although IMDb itself offers open data, I chose to look for a smaller sample.

Thereupon, I found a [site](https://relational.fit.cvut.cz/search) which has a huge collection of dataset on their public `MariaDB` database.

I decided to go with the `imdb_small` dataset which has the following ERD:

<br/>

<p align="center">
<img src="./pictures/imdb_small_erd.png" alt="drawing" width="500">
</p>
*<center> Generated by DataGrip </center>*

<br/>

### Additional informations (retrieved from `SELECT COUNT(DISTINCT *)`)

As you can see the ERD represenets a a Snowflake Schema, therefore it has a more complex normalization and I should do more joins to get to the analytical layer.

- 36 distinct movies
- 1907 actors
- 34 directors
- 16 genres
- 1695 roles
- from 20 different years

<div id='operational'/>

## Operational Layer

I exported the tables as `.TSV` files from the database and [generated DDL scripts](https://www.jetbrains.com/datagrip/features/generation.html) for each table within DataGrip.

*Note: The generation saved me a significant time in defining column names and datatypes.*

Having the data and table structure on my computer, I created tables with from generated schemas in my local MySQL instance with the `01_create_tables.sql` script , and loaded the local flat files with the `02_extract.sql` script.

### Preliminary Cleaning

- Interestingly, *Batman Begins (2005)* has a 0 average rating, while it is currently rated 8.2 on imdb. Let's manually update that entry!
- Some roles are has values of `""` which should be `'unknown'` instead.
- Since `rank` is a reserved keyword in SQL, I will replace it with the name `rating`.
- Rename the column `gender` to `sex` in the actors table to avoid unambiguity

<div id='business'/>

## Analytics (Business Definitions) <a name="business"></a>

The final form of the data mart should be able to answer the following business questions.

### List of analytics:
- How many movies are in each genre? What is the distribution?
- What was the most successful year in movie production?
- Which actor/actress has appeared in the most roles?
- In which genre of movies we have the highest likelihood of seeing an actor/actress?
- What is the average rating of movies directed by Quentin Tarantino?
- Do we see a gender equity in terms of appearance in movies?
- List the directors who also include themselves in movies!

<div id='denorm'/>

## Denormalization <a name="denorm"></a>

I merged together all the dimension and fact tables to a joint table, and concatenated the first and last names of the actors, directors. Now, each entity represents an "actor/actress in a movie in a certain role" (assuming that an actor/actress can have multiple roles in a movie).

<p align="center">
<img src="./pictures/merged_imdb.png" alt="drawing" width="250">
</p>

<div id='etl'/>

## ETL Pipeline

### Change Data Capture (CDC):

For loging the changed data in the movies fact table, I set up triggers for inserts, updates, and deletes on the table. The trigger records the old data, new data (as JSON objects), timestamp, and the user who executed the DML in the movies_audit

Expected behavior when updating a row:

<p align="center">
<img src="./pictures/cdc.png" alt="drawing" width="5500">
</p>

<div id='mart'/>

## Data Mart

<div id='delivery'/>

## Delivery
